# Portfolio-Risk-Managemet

### Question 1

#### Compare the risk and return performance of 4 portfolios (best, worst, and your portfolio before/after subjective adjustment) until 2020 October. 

The table below reports the monthly returns for each of the first 10 months of 2020.
 
![image](https://user-images.githubusercontent.com/71431944/157256768-078fcce9-dac7-4515-a357-785d6ea5010f.png)

To compare the monthly returns in the first 10 months of 2020, we plotted the graph below. 

![image](https://user-images.githubusercontent.com/71431944/157256821-bbb2387a-b59d-44c4-9f23-31b2387002e1.png)

From the graph, we can see that the best, worst and our optimal portfolio had similar peaks and troughs. At the peaks in April and around August, the best portfolio outperformed the worst portfolio. Our optimal portfolio log returns are comparable to that of the best portfolio at the peaks. At the trough in March, the worst portfolio performed the best with the lowest drop in returns, while our optimal portfolio performed the worst. However, at the troughs in June and September, our optimal portfolio outperformed the worst portfolio and the other 2 portfolios respectively.

In October, after subjective adjustment, our portfolio achieved -0.052905 log returns, which is an improvement compared to our portfolio before subjective adjustment. 
Comparison of risk

The table below shows the annualised standard deviation for the first 10 months of 2020. 

 ![image](https://user-images.githubusercontent.com/71431944/157257028-75c2c189-8f19-46a6-bbe7-0786345d3662.png)

The graph below compares the annualised standard deviation by daily return in each month for the first 10 months of 2020. 

 ![image](https://user-images.githubusercontent.com/71431944/157257041-f58b14bd-9973-469c-853c-0e8734b2cb52.png)

Similar to the monthly returns graph, the annualised standard deviations of the 3 portfolios showed similar peaks and troughs. The annualised standard deviation for our optimal portfolio was the highest among the 3 portfolios for the first half of 2020. The annualised standard deviation of our optimal portfolio was the lowest between June to August. From August to October, the annualised standard deviation of the best portfolio was the highest, while that of the worst portfolio was the lowest. 

After subjective adjustment, our portfolio had a higher annualised standard deviation of 26.987472, a slight increase compared to that before subjective adjustment. 

### Question 2

#### Returns analysis

Similar trends are observed for all our best, worst and optimal portfolios. Sharp drops are observed in March and September 2020 whereas sharp peaks are observed in April and August 2020. The sudden decline in March 2020 is consistent with our expectations due to the sudden spread of the COVID-19 pandemic which caused high volatility in market sentiments and investors to be bearish. Hence, low market sentiments would have accounted for a large decline in stock prices, which translates to a fall in returns for all 3 portfolios. However, the extent of the fall in log returns for our optimal portfolio is much larger as compared to the best and worst portfolios which is inconsistent with our expectations. This may be because of the smaller number of stock holdings in our optimal portfolio as compared to the best and worst portfolios. Hence, less diversification within our optimal portfolio may result in the underperformance reflected here.

The peak in April 2020 is also consistent with our expectations as the widespread lockdown of countries have prompted many to switch to remote working. Hence, we expected that technology stocks will rise due to optimistic analyst reports highlighting that the increase in purchase of conferencing software and technological devices as a result of remote working will induce a spike in technological stock prices. The peak in log returns for our optimal portfolio is on par with the best portfolio which is inconsistent with our expectations because we expected log returns of our optimised portfolio to be the highest. This may be because of the smaller number of stock holdings in our optimal portfolio as compared to the best portfolio. Hence, less diversification within our optimal portfolio may result in the slightly lower returns as compared to the best portfolio.

However, we did not expect the sudden peak in returns from July to August 2020 and a sudden drop in September 2020 for all 3 portfolios because we expected the pandemic situation to have stabilised after the first half of the year. In addition, our optimal portfolio’s peak in August is still lower than the best portfolio. This may be due to the lower number of holdings within our optimal portfolio. Nevertheless, our optimal portfolio’s trough is the lowest among all 3 portfolios which is consistent with our expectation — that our optimal portfolio should optimise returns as much as possible.

Comparing our returns in October 2020, although our adjustments have improved the returns for our optimal portfolio after taking analyst reports into account, both are still lower than that of the best and worst portfolios. Since our adjustments are made based on the latest reports in 2020, we are expecting the effects of these adjustments to be reflected over a longer horizon. Hence, the value for October 2020 alone may not reflect the true effect of the adjustments in weights and may undervalue the actual change in our portfolio log returns.
Risk analysis

Comparing the annualised standard deviation (SD) for each month for all 3 portfolios, the sudden peak in volatility in March is expected due to the COVID-19 pandemic which peaked in March 2020. We expected a significantly higher standard deviation in our optimal portfolio since we are aggressive investors who seek high returns, thus the fact that our optimal portfolio has the highest volatility among all other portfolios is consistent with our expectations.
Comparing our annualised SD in October 2020, although our adjustments have increased the SD for our optimal portfolio after taking analyst reports into account, both are still lower than that of the best portfolio. It is also consistent with our expectations since we are willing to bear higher risks for higher returns in October 2020. Hence, since our subjective adjustments place more emphasis on maximising returns rather than minimising volatility, an increase in SD is expected. 

### Question 3

#### Analyse the outcome of the decisions made by the fund managers on the actual stocks. 
Best Fund (FSPTX)
Comparing the number of shares of the top 30 stocks originally (from the holdings in 2019) with the new number of shares of the same top 30 stocks (from the holdings in 2020), we can see that FSPTX has changed the weights of multiple stocks.The adjusted new holdings on 31 September 2020 (Chart 1) for FSPTX is shown below. 

Old portfolio = ["AAPL", "MSFT", "ADBE", "CRM", "NVDA", "MA", "PYPL", "V", "MU", "FIS", "LRCX", "FB", "AMAT", "QCOM", "TWLO", "WDAY", "AMZN", "INTU", "ADSK", "AMD", "HUBS", "MELI", "ESTC", "G", "GDDY", "FLEX", "MDB", "NXPI", "FISV", "MRVL"]

Old number of shares = [15956934.0, 7219840.0, 641861.0, 1070184.0, 445652.0, 613139.0, 1040187.0, 879814.0, 4066983.0, 1191646.0, 493512.0, 553108.0, 2638331.0, 1226502.0, 452186.0, 497271.0, 33655.0, 327091.0, 443415.0, 1190949.0, 353309.0, 85322.0, 904051.0, 2111030.0, 996333.0, 7011334.0, 318341.0, 558207.0, 669494.0, 1595579.0]

New portfolio = ["MSFT" ,"AAPL", "MA" ,"NVDA",  "CRM" , "PYPL" , "FIS", "MRVL", "FLEX" ,"FB" , "ADSK", "G","WDAY","MU" ,"ADBE", "ESTC","AMD","NXPI","QCOM" ,"V", "GDDY","TWLO" ,"MDB" ,"AMAT" ,"FISV", "LRCX","HUBS" ]

New adjusted shares = [8467640.0, 8101441.0, 1364924.0, 631939.0, 1103388.0 ,  1194400.0, 1372462.0, 5009396.0, 4295000.0, 529000.0, 587300.0, 3478178.0, 586960.0, 2476900.0, 231439.0, 1020500.0, 1053300.0, 1775259.0, 4718700.0, 1235700.0, 1088900.0, 1295458.0, 776850.0, 817555.0, 1044000.0, 1742878.0]

Apple’s stock has been adjusted the most as its number of shares have decreased by 49%, while weights for other stocks such as CRM have increased by 3.1%. The weights of AMZN, INTU and MELI were removed from this adjusted portfolio as the adjusted portfolio does not contain these 3 stocks. 

Based on our calculation, the portfolio returns for October before adjustments is 0.059311 while the portfolio returns after adjustments is 0.060554. This shows that the adjustment of the weights for the best fund were effective in increasing portfolio return for the month of October.

Worst Fund (FDMAX)
The worst fund adjusted its holdings on July 31st 2020 to the new holdings as shown in Chart 2. The previous holdings in 2019 are also shown in Chart 3. Comparing the number of shares of the top 30 stocks originally (from the holdings in 2019) with the new number of shares of the same top 30 stocks (from the holdings in 2020), we can see that FDMAX has changed the weights of multiple stocks. 

Old number of shares:
[352792.6383526307, 229221.01594689395, 75106.41375934568, 6827.000585652449, 15341.007450721228, 34646.0, 5257.870951759046, 7342.0, 18866.984882021916, 40250.89908982011, 7764.996649872879, 1851.9982351839342, 20679.0223250981, 6582.288255712012, 9285.991337681795, 15057.001261454807, 23342.038402704806, 4163.653988214169, 379.9863804812327, 699.9999900412706, 4095.988376726698, 19733.05052849316, 9858.97191123898, 24421.968602945653, 9125.000363858333, 1594.0065121024033, 5978.443286421669, 2164.006499898301, 1732.9945035922321, 12150.933983792662]

New number of shares:
[361221, 114105, 64490, 6323, 15611, 35750, 5253, 7575, 21379, 41553, 8007, 2212, 29260, 6749, 15481, 15542, 38703, 5611, 0, 0, 4258, 20454, 10168, 25461, 14415, 1626, 0, 2164, 1733, 0]

A significant change from the old to the new holdings is that FDMAX decreased the shares of stocks, FTNT, PANW, SW.TO and RBBN to 0 shares, hence completely removing them from its top 30 stocks. FDMAX also decreased the shares of its most heavily weighted stock, ERIC by about 2.33%. Overall, the changes made to its holdings have improved FDMAX’s monthly returns from August 2020 till October 2020. As seen from the figure below, FDMAX’s monthly losses have decreased as its returns became less negative for all 3 months in 2020 as compared to if they had continued with the original holdings. Hence, FDMAX’s decisions regarding the changes in its holdings were correct and helped improve its performance in 2020.

![image](https://user-images.githubusercontent.com/71431944/157257185-487ee1e1-aaaf-4508-87dc-8ea45390a784.png)

### Question 4
#### 	Hedging
Before deciding on the index fund to use for hedging, we ran OLS regression of our portfolio against three index funds (VGT, S&P 500 and IYW) to determine which index fund was the most highly correlated with our portfolio.

![image](https://user-images.githubusercontent.com/71431944/157257280-31c109fe-7a9c-4e89-9f24-1f58bbfdcbe8.png)

From our OLS regression, we found that the R-squared and adjusted R-squared was the highest when our portfolio was regressed against VGT. This shows that our portfolio was most correlated with VGT and hence we chose VGT as the index fund for hedging. As verification, we calculated the correlation between our portfolio and VGT using the CAPM beta formula correlation = (beta*(sd_index))/sd_portfolio, and obtained a correlation of 0.965, showing that our portfolio was indeed highly correlated with the index fund VGT.
Since the goal is to improve risk-adjusted return and hedge against a drop in portfolio value, we would be buying put options. We chose 21 Feb 2020 as the expiration date for the options we wanted to buy, and we bought put options at strike price 240 as it was the closest to our estimated strike price of 238.60.

The table below shows the payoff and the portfolio returns with and without hedging. We see that hedging did not improve our percentage returns for our optimal portfolio as our put options expire worthless. This is because the price of VGT actually increased to 262.38 on 21 Feb 2020, hence we did not profit from buying the options. The portfolio return after hedging also decreased after accounting for the cost of buying the options.  

![image](https://user-images.githubusercontent.com/71431944/157257356-04a57fad-2500-4325-a682-d6f2d9e96489.png)

From the results above, we see that buying options with expiration on all three dates were not profitable as our payoffs were all 0, meaning our put options would have all expired worthless. However, among these options, hedging using the option that expires in February gave us the least decrease in percentage return (1.79%), as the option premium in February is the lowest.

### Question 5
#### Stock Forecasting 
Input features and dependent variable
For our independent variables we have chosen to use technical analysis indicators, relative strength indicator (RSI), simple moving average (SMA) and momentum indicator (MOM) as inputs to our model. The RSI indicator which was developed by Welles Wilder, is a momentum oscillator that is very popular in financial technical analysis . We have chosen to use RSI as, in the context of forecasting financial market movements, RSI is commonly used as one of the signals to define enter and exit rules . The SMA indicator is a momentum-based indicator that generates buy or sell signals depending on the direction from which the stock prices cross the moving average price . We also chose to use MOM as it helps us see the movement of prices over time hence it can be useful for our stock prediction as it is a time series prediction. 

For our dependent variable (Y) of our model, we constructed a binary label where Y=1 when daily returns of the stock > 0, else Y=0. Based on the dependent variable of the model, we will further output a target variable Y=0 or Y=1 or Y=-1 to determine which stocks to hold, buy or sell eventually.

Model training and validation
We have chosen to use XGBoost as our model for stock prediction. To train our model, we used daily returns from 1st January 2018 to 30th April 2019 as the training dataset to compute our input features as stated above. For our model validation, we used daily returns from 1st May 2019 to 31st December 2019 as the validation dataset. Our training and validation datasets have been split by a fixed time point as it is not suitable to do k-fold cross validation on time series data. 

After the first round of training and validation of our models, we realised that there were some stocks such as MSFT, LRCX, FB, and MDB, with lower F1 Scores for their prediction models. Hence, we carried out hyperparameter tuning using Bayesian Optimisation, and obtained the best set of hyperparameters . Using this best set of hyperparameters, we proceeded to train and validate our models once again.

Performance evaluation 
Finally, to test our model, we used daily returns from 1st January 2020 to 31st October 2020 as our testing dataset. The table below reports the F1 score of the test sets before and after tuning our model. As seen from the table, most of the stocks with lower F1 Scores before tuning have higher F1 Scores after tuning. Majority of the stock prediction models have obtained high F1 Scores of above 0.8, indicating that the models indeed performed better after tuning. 

